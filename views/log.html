<div class="space-y-4 md:space-y-6">
  <div
    class="flex flex-col sm:flex-row justify-between items-start sm:items-center gap-3"
  >
    <div>
      <h2
        class="text-2xl md:text-3xl font-bold text-gray-800 dark:text-white mb-1"
      >
        <i class="bx bx-history text-blue-600 dark:text-blue-400"></i> Activity
        Log
      </h2>
      <p class="text-sm text-gray-600 dark:text-gray-400">
        Log semua aktivitas dan perubahan database
      </p>
    </div>
  </div>

  <!-- Search and Filter -->
  <div
    class="bg-white dark:bg-gray-800 rounded-xl shadow-lg p-4 md:p-6 border border-gray-200 dark:border-gray-700"
  >
    <div class="flex flex-col sm:flex-row gap-3">
      <div class="flex-1">
        <input
          type="text"
          id="searchInput"
          placeholder="Cari berdasarkan deskripsi, aksi, tabel, atau user..."
          class="w-full px-4 py-2.5 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:text-white transition-all"
        />
      </div>
      <button
        onclick="searchLogs()"
        class="px-5 py-2.5 bg-gradient-to-r from-blue-600 to-blue-700 hover:from-blue-700 hover:to-blue-800 text-white rounded-lg transition-all duration-300 font-medium shadow-md hover:shadow-lg flex items-center gap-2"
      >
        <i class="bx bx-search text-lg"></i> <span>Cari</span>
      </button>
      <button
        onclick="resetSearch()"
        class="px-5 py-2.5 bg-gray-500 hover:bg-gray-600 text-white rounded-lg transition-all duration-300 font-medium shadow-md hover:shadow-lg flex items-center gap-2"
      >
        <i class="bx bx-refresh text-lg"></i> <span>Reset</span>
      </button>
      <button
        id="autoRefreshBtn"
        onclick="toggleAutoRefresh()"
        class="px-5 py-2.5 bg-green-500 hover:bg-green-600 text-white rounded-lg transition-all duration-300 font-medium shadow-md hover:shadow-lg flex items-center gap-2"
        title="Toggle Auto Refresh"
      >
        <i class="bx bx-refresh text-lg" id="autoRefreshIcon"></i>
        <span id="autoRefreshText">Auto Refresh: ON</span>
      </button>
    </div>
    <div
      id="refreshIndicator"
      class="hidden mt-2 text-xs text-gray-500 dark:text-gray-400 flex items-center gap-2"
    >
      <i class="bx bx-loader-alt animate-spin"></i>
      <span>Memperbarui data...</span>
    </div>
  </div>

  <!-- Log Table -->
  <div
    class="bg-white dark:bg-gray-800 rounded-xl shadow-lg overflow-hidden border border-gray-200 dark:border-gray-700"
  >
    <div class="overflow-x-auto">
      <table class="min-w-full divide-y divide-gray-200 dark:divide-gray-700">
        <thead
          class="bg-gradient-to-r from-gray-50 to-gray-100 dark:from-gray-700 dark:to-gray-800"
        >
          <tr>
            <th
              class="px-2 py-1.5 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase"
            >
              Waktu
            </th>
            <th
              class="px-2 py-1.5 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase"
            >
              User
            </th>
            <th
              class="px-2 py-1.5 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase"
            >
              Aksi
            </th>
            <th
              class="px-2 py-1.5 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase"
            >
              Tabel
            </th>
            <th
              class="px-2 py-1.5 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase"
            >
              Deskripsi
            </th>
            <th
              class="px-2 py-1.5 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase"
            >
              Detail
            </th>
          </tr>
        </thead>
        <tbody
          id="logTableBody"
          class="bg-white dark:bg-gray-800 divide-y divide-gray-200 dark:divide-gray-700"
        >
          <!-- Data akan diisi oleh JavaScript -->
        </tbody>
      </table>
    </div>

    <!-- Pagination -->
    <div
      id="paginationContainer"
      class="px-4 py-3 bg-gray-50 dark:bg-gray-700 border-t border-gray-200 dark:border-gray-600"
    >
      <!-- Pagination info and controls will be inserted here -->
    </div>
  </div>
</div>

<!-- Modal untuk detail log -->
<div
  id="detailModal"
  class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4"
>
  <div
    class="bg-white dark:bg-gray-800 rounded-lg p-4 md:p-6 w-full max-w-2xl max-h-[90vh] overflow-y-auto"
  >
    <div class="flex justify-between items-center mb-4">
      <h3
        class="text-xl font-bold text-gray-800 dark:text-white"
        id="detailModalTitle"
      >
        Detail Log
      </h3>
      <button
        onclick="closeDetailModal()"
        class="text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200"
      >
        <i class="bx bx-x text-2xl"></i>
      </button>
    </div>
    <div id="detailModalContent" class="space-y-4">
      <!-- Detail content will be inserted here -->
    </div>
  </div>
</div>

<script>
  const logs = {{logs}} || [];
  const pagination = {{pagination}} || { page: 1, limit: 50, total: 0, totalPages: 1, search: "" };

  let currentPage = pagination.page;
  let currentSearch = pagination.search || "";
  let autoRefreshInterval = null;
  let autoRefreshEnabled = true; // Default enabled
  const REFRESH_INTERVAL = 30000; // 30 seconds

  // Set search input value
  if (currentSearch) {
    document.getElementById("searchInput").value = currentSearch;
  }

  // Load data via AJAX
  async function loadLogsData(page = currentPage, limit = pagination.limit, search = currentSearch, showIndicator = true) {
    try {
      // Don't refresh if detail modal is open
      const modal = document.getElementById("detailModal");
      if (modal && !modal.classList.contains("hidden")) {
        return;
      }

      const indicator = document.getElementById("refreshIndicator");
      if (showIndicator) {
        indicator.classList.remove("hidden");
      }

      const params = new URLSearchParams({
        page: page.toString(),
        limit: limit.toString(),
      });
      if (search) {
        params.append("search", search);
      }

      const response = await fetch(`/log/api?${params.toString()}`);
      const result = await response.json();

      if (result.success) {
        // Update logs and pagination
        logs.length = 0;
        logs.push(...result.data);

        pagination.page = result.pagination.page;
        pagination.limit = result.pagination.limit;
        pagination.total = result.pagination.total;
        pagination.totalPages = result.pagination.totalPages;
        pagination.search = search;

        currentPage = pagination.page;
        currentSearch = search;

        // Re-render
        renderLogs();
        renderPagination();

        // Update search input
        document.getElementById("searchInput").value = currentSearch;
      }
    } catch (error) {
      console.error("Error loading logs:", error);
    } finally {
      const indicator = document.getElementById("refreshIndicator");
      if (showIndicator) {
        indicator.classList.add("hidden");
      }
    }
  }

  // Toggle auto refresh
  function toggleAutoRefresh() {
    autoRefreshEnabled = !autoRefreshEnabled;
    const btn = document.getElementById("autoRefreshBtn");
    const icon = document.getElementById("autoRefreshIcon");
    const text = document.getElementById("autoRefreshText");

    if (autoRefreshEnabled) {
      btn.className = "px-5 py-2.5 bg-green-500 hover:bg-green-600 text-white rounded-lg transition-all duration-300 font-medium shadow-md hover:shadow-lg flex items-center gap-2";
      text.textContent = "Auto Refresh: ON";
      icon.className = "bx bx-refresh text-lg";
      startAutoRefresh();
    } else {
      btn.className = "px-5 py-2.5 bg-gray-500 hover:bg-gray-600 text-white rounded-lg transition-all duration-300 font-medium shadow-md hover:shadow-lg flex items-center gap-2";
      text.textContent = "Auto Refresh: OFF";
      icon.className = "bx bx-refresh text-lg";
      stopAutoRefresh();
    }
  }

  // Start auto refresh
  function startAutoRefresh() {
    if (autoRefreshInterval) {
      clearInterval(autoRefreshInterval);
    }
    autoRefreshInterval = setInterval(() => {
      if (autoRefreshEnabled) {
        // Don't show indicator for auto-refresh (silent update)
        loadLogsData(currentPage, pagination.limit, currentSearch, false);
      }
    }, REFRESH_INTERVAL);
  }

  // Stop auto refresh
  function stopAutoRefresh() {
    if (autoRefreshInterval) {
      clearInterval(autoRefreshInterval);
      autoRefreshInterval = null;
    }
  }

  function renderLogs() {
    const tbody = document.getElementById("logTableBody");
    tbody.innerHTML = "";

    if (logs.length === 0) {
      tbody.innerHTML = `
        <tr>
          <td colspan="6" class="px-4 py-4 text-center text-gray-500 dark:text-gray-400">
            <i class="bx bx-info-circle text-3xl mb-2"></i>
            <p class="text-sm">Tidak ada data log</p>
          </td>
        </tr>
      `;
      return;
    }

    logs.forEach((log) => {
      const row = document.createElement("tr");
      row.className =
        "hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors";

      const waktu = new Date(log.created_at).toLocaleString("id-ID", {
        year: "numeric",
        month: "2-digit",
        day: "2-digit",
        hour: "2-digit",
        minute: "2-digit",
        second: "2-digit",
      });

      const actionBadge = getActionBadge(log.action);
      const userDisplay = log.user_nama || log.username || "System";

      row.innerHTML = `
        <td class="px-2 py-1.5 text-xs text-gray-700 dark:text-gray-300 whitespace-nowrap">
          ${waktu}
        </td>
        <td class="px-2 py-1.5 text-xs text-gray-700 dark:text-gray-300">
          ${userDisplay}
        </td>
        <td class="px-2 py-1.5">
          ${actionBadge}
        </td>
        <td class="px-2 py-1.5 text-xs text-gray-700 dark:text-gray-300">
          ${log.table_name || "-"}
        </td>
        <td class="px-2 py-1.5 text-xs text-gray-700 dark:text-gray-300">
          ${log.description || "-"}
        </td>
        <td class="px-2 py-1.5">
          <button
            onclick="showDetail(${log.id})"
            class="px-2 py-1 bg-blue-100 dark:bg-blue-900 text-blue-700 dark:text-blue-300 rounded hover:bg-blue-200 dark:hover:bg-blue-800 transition-colors text-xs font-medium"
          >
            <i class="bx bx-info-circle"></i> Detail
          </button>
        </td>
      `;

      tbody.appendChild(row);
    });
  }

  function getActionBadge(action) {
    const badges = {
      INSERT: '<span class="px-1.5 py-0.5 bg-green-100 dark:bg-green-900 text-green-700 dark:text-green-300 rounded text-xs font-medium">INSERT</span>',
      UPDATE: '<span class="px-1.5 py-0.5 bg-yellow-100 dark:bg-yellow-900 text-yellow-700 dark:text-yellow-300 rounded text-xs font-medium">UPDATE</span>',
      DELETE: '<span class="px-1.5 py-0.5 bg-red-100 dark:bg-red-900 text-red-700 dark:text-red-300 rounded text-xs font-medium">DELETE</span>',
      LOGIN: '<span class="px-1.5 py-0.5 bg-blue-100 dark:bg-blue-900 text-blue-700 dark:text-blue-300 rounded text-xs font-medium">LOGIN</span>',
      LOGIN_FAILED: '<span class="px-1.5 py-0.5 bg-orange-100 dark:bg-orange-900 text-orange-700 dark:text-orange-300 rounded text-xs font-medium">LOGIN FAILED</span>',
      LOGOUT: '<span class="px-1.5 py-0.5 bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300 rounded text-xs font-medium">LOGOUT</span>',
    };
    return badges[action] || `<span class="px-1.5 py-0.5 bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300 rounded text-xs font-medium">${action}</span>`;
  }

  function renderPagination() {
    const container = document.getElementById("paginationContainer");
    const total = pagination.total || 0;
    const totalPages = pagination.totalPages || 1;
    const limit = pagination.limit || 50;
    const start = total === 0 ? 0 : (currentPage - 1) * limit + 1;
    const end = Math.min(currentPage * limit, total);

    // Generate page numbers to show
    const getPageNumbers = () => {
      const pages = [];
      const maxVisible = 5;

      if (totalPages <= maxVisible) {
        // Show all pages if total pages is less than max visible
        for (let i = 1; i <= totalPages; i++) {
          pages.push(i);
        }
      } else {
        // Show pages around current page
        if (currentPage <= 3) {
          // Near the beginning
          for (let i = 1; i <= maxVisible; i++) {
            pages.push(i);
          }
        } else if (currentPage >= totalPages - 2) {
          // Near the end
          for (let i = totalPages - maxVisible + 1; i <= totalPages; i++) {
            pages.push(i);
          }
        } else {
          // In the middle
          for (let i = currentPage - 2; i <= currentPage + 2; i++) {
            pages.push(i);
          }
        }
      }
      return pages;
    };

    const pageNumbers = getPageNumbers();

    container.innerHTML = `
      <div class="flex flex-col sm:flex-row justify-between items-center gap-4">
        <!-- Info and limit selector -->
        <div class="flex flex-col sm:flex-row items-center gap-3">
          <div class="text-sm text-gray-600 dark:text-gray-400">
            Menampilkan <span class="font-semibold">${start}</span> - <span class="font-semibold">${end}</span> dari <span class="font-semibold">${total}</span> log
          </div>
          <div class="flex items-center gap-2">
            <label class="text-xs text-gray-600 dark:text-gray-400">Per halaman:</label>
            <select
              id="limitSelect"
              onchange="changeLimit(this.value)"
              class="px-2 py-1 text-sm border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-700 dark:text-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
            >
              <option value="25" ${limit === 25 ? "selected" : ""}>25</option>
              <option value="50" ${limit === 50 ? "selected" : ""}>50</option>
              <option value="100" ${limit === 100 ? "selected" : ""}>100</option>
              <option value="200" ${limit === 200 ? "selected" : ""}>200</option>
            </select>
          </div>
        </div>

        <!-- Pagination controls -->
        ${totalPages > 1 ? `
        <div class="flex items-center gap-1">
          <!-- First button -->
          <button
            onclick="goToPage(1)"
            ${currentPage === 1 ? "disabled" : ""}
            class="px-2 py-1.5 bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-600 text-gray-700 dark:text-gray-300 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed text-sm"
            title="Halaman pertama"
          >
            <i class="bx bx-chevrons-left"></i>
          </button>

          <!-- Previous button -->
          <button
            onclick="goToPage(${currentPage - 1})"
            ${currentPage === 1 ? "disabled" : ""}
            class="px-2 py-1.5 bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-600 text-gray-700 dark:text-gray-300 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed text-sm"
            title="Halaman sebelumnya"
          >
            <i class="bx bx-chevron-left"></i>
          </button>

          <!-- Page numbers -->
          ${pageNumbers[0] > 1 ? `
            <button
              onclick="goToPage(1)"
              class="px-3 py-1.5 bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-600 text-gray-700 dark:text-gray-300 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors text-sm"
            >
              1
            </button>
            ${pageNumbers[0] > 2 ? '<span class="px-2 text-gray-500 dark:text-gray-400">...</span>' : ''}
          ` : ''}

          ${pageNumbers.map(page => `
            <button
              onclick="goToPage(${page})"
              ${currentPage === page ? "disabled" : ""}
              class="px-3 py-1.5 rounded-lg transition-colors text-sm font-medium ${
                currentPage === page
                  ? "bg-blue-600 text-white border border-blue-600"
                  : "bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-600 text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-700"
              } disabled:cursor-default"
            >
              ${page}
            </button>
          `).join('')}

          ${pageNumbers[pageNumbers.length - 1] < totalPages ? `
            ${pageNumbers[pageNumbers.length - 1] < totalPages - 1 ? '<span class="px-2 text-gray-500 dark:text-gray-400">...</span>' : ''}
            <button
              onclick="goToPage(${totalPages})"
              class="px-3 py-1.5 bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-600 text-gray-700 dark:text-gray-300 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors text-sm"
            >
              ${totalPages}
            </button>
          ` : ''}

          <!-- Next button -->
          <button
            onclick="goToPage(${currentPage + 1})"
            ${currentPage === totalPages ? "disabled" : ""}
            class="px-2 py-1.5 bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-600 text-gray-700 dark:text-gray-300 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed text-sm"
            title="Halaman berikutnya"
          >
            <i class="bx bx-chevron-right"></i>
          </button>

          <!-- Last button -->
          <button
            onclick="goToPage(${totalPages})"
            ${currentPage === totalPages ? "disabled" : ""}
            class="px-2 py-1.5 bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-600 text-gray-700 dark:text-gray-300 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed text-sm"
            title="Halaman terakhir"
          >
            <i class="bx bx-chevrons-right"></i>
          </button>
        </div>

        <!-- Go to page input -->
        <div class="flex items-center gap-2">
          <label class="text-xs text-gray-600 dark:text-gray-400">Ke halaman:</label>
          <input
            type="number"
            id="gotoPageInput"
            min="1"
            max="${totalPages}"
            value="${currentPage}"
            onkeypress="if(event.key === 'Enter') goToPageInput()"
            class="w-16 px-2 py-1 text-sm border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-700 dark:text-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
          />
          <button
            onclick="goToPageInput()"
            class="px-3 py-1 text-sm bg-blue-600 hover:bg-blue-700 text-white rounded-lg transition-colors"
          >
            Go
          </button>
        </div>
        ` : ''}
      </div>
    `;
  }

  function changeLimit(newLimit) {
    loadLogsData(1, parseInt(newLimit), currentSearch);
  }

  function goToPageInput() {
    const input = document.getElementById("gotoPageInput");
    const page = parseInt(input.value);
    if (page >= 1 && page <= pagination.totalPages) {
      goToPage(page);
    } else {
      alert(`Masukkan nomor halaman antara 1 dan ${pagination.totalPages}`);
      input.value = currentPage;
    }
  }

  function goToPage(page) {
    if (page < 1 || page > pagination.totalPages) return;
    loadLogsData(page, pagination.limit, currentSearch);
  }

  function searchLogs() {
    const search = document.getElementById("searchInput").value.trim();
    loadLogsData(1, pagination.limit, search);
  }

  function resetSearch() {
    document.getElementById("searchInput").value = "";
    loadLogsData(1, pagination.limit, "");
  }

  // Handle Enter key in search input
  document.getElementById("searchInput").addEventListener("keypress", (e) => {
    if (e.key === "Enter") {
      searchLogs();
    }
  });

  async function showDetail(logId) {
    const log = logs.find((l) => l.id === logId);
    if (!log) return;

    const modal = document.getElementById("detailModal");
    const content = document.getElementById("detailModalContent");

    let oldDataHtml = "";
    let newDataHtml = "";

    if (log.old_data) {
      try {
        const oldData = JSON.parse(log.old_data);
        oldDataHtml = `
          <div>
            <h4 class="font-semibold text-gray-700 dark:text-gray-300 mb-2">Data Lama:</h4>
            <pre class="bg-gray-100 dark:bg-gray-700 p-3 rounded-lg text-xs overflow-x-auto">${JSON.stringify(oldData, null, 2)}</pre>
          </div>
        `;
      } catch (e) {
        oldDataHtml = `
          <div>
            <h4 class="font-semibold text-gray-700 dark:text-gray-300 mb-2">Data Lama:</h4>
            <pre class="bg-gray-100 dark:bg-gray-700 p-3 rounded-lg text-xs overflow-x-auto">${log.old_data}</pre>
          </div>
        `;
      }
    }

    if (log.new_data) {
      try {
        const newData = JSON.parse(log.new_data);
        newDataHtml = `
          <div>
            <h4 class="font-semibold text-gray-700 dark:text-gray-300 mb-2">Data Baru:</h4>
            <pre class="bg-gray-100 dark:bg-gray-700 p-3 rounded-lg text-xs overflow-x-auto">${JSON.stringify(newData, null, 2)}</pre>
          </div>
        `;
      } catch (e) {
        newDataHtml = `
          <div>
            <h4 class="font-semibold text-gray-700 dark:text-gray-300 mb-2">Data Baru:</h4>
            <pre class="bg-gray-100 dark:bg-gray-700 p-3 rounded-lg text-xs overflow-x-auto">${log.new_data}</pre>
          </div>
        `;
      }
    }

    content.innerHTML = `
      <div class="space-y-3">
        <div>
          <span class="text-sm font-medium text-gray-500 dark:text-gray-400">Waktu:</span>
          <p class="text-gray-800 dark:text-white">${new Date(log.created_at).toLocaleString("id-ID")}</p>
        </div>
        <div>
          <span class="text-sm font-medium text-gray-500 dark:text-gray-400">User:</span>
          <p class="text-gray-800 dark:text-white">${log.user_nama || log.username || "System"}</p>
        </div>
        <div>
          <span class="text-sm font-medium text-gray-500 dark:text-gray-400">Aksi:</span>
          <p class="text-gray-800 dark:text-white">${getActionBadge(log.action)}</p>
        </div>
        <div>
          <span class="text-sm font-medium text-gray-500 dark:text-gray-400">Tabel:</span>
          <p class="text-gray-800 dark:text-white">${log.table_name || "-"}</p>
        </div>
        <div>
          <span class="text-sm font-medium text-gray-500 dark:text-gray-400">Record ID:</span>
          <p class="text-gray-800 dark:text-white">${log.record_id || "-"}</p>
        </div>
        <div>
          <span class="text-sm font-medium text-gray-500 dark:text-gray-400">Deskripsi:</span>
          <p class="text-gray-800 dark:text-white">${log.description || "-"}</p>
        </div>
        ${log.ip_address ? `
        <div>
          <span class="text-sm font-medium text-gray-500 dark:text-gray-400">IP Address:</span>
          <p class="text-gray-800 dark:text-white">${log.ip_address}</p>
        </div>
        ` : ""}
        ${log.user_agent ? `
        <div>
          <span class="text-sm font-medium text-gray-500 dark:text-gray-400">User Agent:</span>
          <p class="text-gray-800 dark:text-white text-xs">${log.user_agent}</p>
        </div>
        ` : ""}
        ${oldDataHtml}
        ${newDataHtml}
      </div>
    `;

    modal.classList.remove("hidden");
  }

  function closeDetailModal() {
    document.getElementById("detailModal").classList.add("hidden");
  }

  // Close modal when clicking outside
  document.getElementById("detailModal").addEventListener("click", (e) => {
    if (e.target.id === "detailModal") {
      closeDetailModal();
    }
  });

  // Initialize
  renderLogs();
  renderPagination();

  // Start auto refresh on page load
  if (autoRefreshEnabled) {
    startAutoRefresh();
  }

  // Cleanup on page unload
  window.addEventListener("beforeunload", () => {
    stopAutoRefresh();
  });

  // Pause auto refresh when tab is hidden, resume when visible
  document.addEventListener("visibilitychange", () => {
    if (document.hidden) {
      stopAutoRefresh();
    } else if (autoRefreshEnabled) {
      startAutoRefresh();
      // Refresh immediately when tab becomes visible
      loadLogsData(currentPage, pagination.limit, currentSearch);
    }
  });
</script>
